<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.polaroid.app.member.MemberMapper">

		<!-- 인증번호 메일 전송 -->
		<insert id="insertAuthentication" parameterType="map">
				INSERT INTO auth_temp(auth_email, auth_code)
				VALUES(#{authEmail}, #{authCode})
		</insert>

		<!-- 인증번호 일치 여부 -->
		<select id="selectAuthentication" parameterType="int" resultType="int">
				SELECT COUNT(auth_code)
				FROM auth_temp
				WHERE auth_code = #{memberAuthentication}
		</select>
		
		<!-- 이메일 중복 체크 -->
		<select id="selectEmail" parameterType="String" resultType="int">
				SELECT COUNT(member_email)
				FROM member
				WHERE member_email = #{memberEmail}
		</select>
		
		<!-- 닉네임 중복 체크 -->
		<select id="selectNick" parameterType="String" resultType="int">
				SELECT COUNT(member_nick)
				FROM member
				WHERE member_nick = #{memberNick}
		</select>
		
		<!-- 전화번호 중복 체크 -->
		<select id="selectPhone" parameterType="String" resultType="int">
				SELECT COUNT(member_phone)
				FROM member
				WHERE member_phone = #{memberPhone}
		</select>

		<!-- 회원가입 -->
		<insert id="insertMember" parameterType="MemberDto">
				INSERT INTO member(member_email,
												 member_nick,
												 member_name,
												 member_phone,
												 member_pwd)
				VALUES(#{memberEmail},
							#{memberNick},
							#{memberName},
							#{memberPhone},
							#{memberPwd})
		</insert>
		
		<!-- 로그인 -->
		<select id="selectMember" parameterType="MemberDto" resultType="MemberDto">
				SELECT member_id AS memberId,
							member_email AS memberEmail,
							member_nick AS memberNick,
							member_name AS memberName,
							member_phone AS memberPhone,
							member_pwd AS memberPwd,
							member_statuscode AS memberStatusCode
				FROM member
				WHERE member_email = #{memberEmail}
							AND
							member_pwd = #{memberPwd}
		</select>
		
		<!-- 회원탈퇴 및 비밀번호 일치 여부 -->
		<update id="updateMember" parameterType="String">
				UPDATE member
				SET member_statuscode = '1'
				WHERE member_pwd = #{memberPwd}
		</update>
		
</mapper>
